{
    "collab_server" : "",
    "contents" : "library(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\ndf <- read.table(\"all_alk.rep\",header=T)\nmytheme <- theme(panel.grid.major.x = element_blank(), panel.grid.minor.y = element_blank(), panel.grid.major.y = element_blank() )\nmytheme <- mytheme + theme(text=element_text(size=14)) + theme(axis.title.x=element_text(size=24) ,axis.title.y=element_text(size=24))\nmytheme <- mytheme + theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(),panel.grid.minor.y = element_line(colour=\"grey60\", linetype=\"dashed\"), panel.grid.major.y = element_blank() )\nmytheme <- mytheme + theme( panel.background = element_rect(fill=\"white\"), panel.border = element_rect(colour=\"black\", fill=NA, size=1))\nnames(df)\ntit <- \"Male\"\ntdf <- gather(df,age,proportion,5:19) %>% filter(Year>=1992,Strata>1,Strata<99,Sex==1) %>%\ntit <- \"Female\"\ntdf <- gather(df,age,proportion,5:19) %>% filter(Year>=1992,Strata>1,Strata<99,Sex==2) %>%\nmutate(age=as.numeric(age)) %>% group_by(Year,Strata,Length) %>% summarise(ma = sum(age*proportion))\ntbl_df(tdf)\nggplot(tdf,aes(x=Length,y=ma,colour=as.factor(Strata)))  + xlim(20,65) + geom_line() + facet_wrap( ~ Year) +\n  labs(y=\"Mean age (years)\",col=\"strata\") + mytheme + ggtitle(tit) +\n  scale_colour_discrete(labels=c(\"W of 170W\", \"E of 170W\" ))\n\ntdf <- gather(df,age,proportion,5:19) %>% filter(Year>=1992,Strata>1,Strata<99,Sex==2) %>%\ntit <- \"Male\"\ntdf <- gather(df,age,proportion,5:19) %>% filter(Year>=1992,Strata>1,Strata<99,Sex==1) %>%\nmutate(age=as.numeric(age)) %>% group_by(Strata,Length) %>% summarise(ma = sum(age*proportion))\nggplot(tdf,aes(x=Length,y=ma,colour=as.factor(Strata)))  + xlim(20,65) + geom_line() + \n  labs(y=\"Mean age (years)\",col=\"strata\") + mytheme + ggtitle(tit) +\n  scale_colour_discrete(labels=c(\"W of 170W\", \"E of 170W\" ))\n  \ntbl_df(tdf)\nas.numeric(tdf$age)\n\nbs <- read.table(\"catagebs.dat\",header=T)\nnames(bs)\ntbs <- gather(bs,age,catch,3:17)\nglimpse(tbs)\ntbl_df(tbs)\nneff <- 3000\ntt <- filter(tbs,yr>=1999) %>% mutate(age=as.numeric(age)) %>%\n  group_by(yr,sim) %>% mutate(ff=sum(catch),proportion=catch/ff) %>% group_by(yr,age) %>%\n  summarise(p=mean(proportion), cv=sqrt(var(proportion))/p, cv1=sqrt(p*(1-p)/neff)/p)\n\n# First compute the variance of mean age-------------\ntt <- filter(tbs) %>% mutate(age=as.numeric(age)) %>% group_by(yr,sim) %>% \n  mutate(ff=sum(catch),proportion=catch/ff) %>% group_by(yr,age) %>%\n  summarise(p=mean(proportion), cv=sqrt(var(proportion))/p)      #%>%\n  group_by(yr) %>% summarise(mobs=sum(p*age),var=sum(age*age*p)-mobs*mobs,sd=sqrt(var))\nt2 <- group_by(tt,yr) %>% summarise(mobs=sum(p*age),var=sum(age*age*p)-mobs*mobs,sd=sqrt(var))\n  dim(t2)\n  dim(tt)\n  mobs <- pobs %*% av\n  stmp <- sqrt(elem_prod(av,av)*pobs - mobs*mobs));\n\n# Check if proportions look right...\nggplot(tt, aes(x=age,y=p)) +  geom_line() + facet_wrap( ~ yr) + mytheme #+ ggtitle(paste(\"Sample size =\"f))\n# Look at mean age over years\ngroup_by(tt,yr) %>% mutate(mean_age=sum(age*p)) %>% ggplot(aes(x=yr,y=mean_age)) + geom_line() + mytheme\n\n#Variance in age over bootstrap samples \ntt <- filter(tbs) %>% mutate(age=as.numeric(age)) %>% group_by(yr,sim) %>% \n   mutate(ff=sum(catch), p=catch/ff) %>% summarise(ma=sum(age*p)) %>% \n   group_by(yr) %>% summarise(varA=var(ma))\nt2 <- group_by(tt,yr) %>% summarise(mobs=sum(p*age),var=sum(age*age*p)-mobs*mobs,sd=sqrt(var))\n# Effective sample size from Francis\nt2$var/tt$varA\ncbind(tt,t2)\n\n\n\n\ndf <- read.table(\"LF_2014.rep\",header=T)\ndf <- as.data.frame(df)\ntbl_df(df)\nt2 <- df %>% mutate(length=as.numeric(length)) %>% group_by(year,Sim) %>% \n  mutate(ff=sum(freq),proportion=freq/ff) %>% group_by(year,length) %>%\n  summarise(p=mean(proportion), cv=sqrt(var(proportion))/p)      %>%\n  group_by(year) %>% summarise(mobs=sum(p*length),var=sum(length*length*p)-mobs*mobs,sd=sqrt(var))\n\n#Variance in length over bootstrap samples \ntt <- df %>% mutate(length=as.numeric(length)) %>% group_by(year,Sim) %>% \n   mutate(ff=sum(freq), p=freq/ff) %>% summarise(ma=sum(length*p)) %>% \n   group_by(year) %>% summarise(varA=var(ma))\ndf %>% select(year,Sim,length,freq) %>% mutate(length=as.numeric(length)) %>% group_by(year,Sim) %>% \n  mutate(ff=sum(freq),p=freq/ff) %>% summarise(sum(p))  #%>% #group_by(year,length) %>%\n  #summarise(p=mean(proportion), cv=sqrt(var(proportion))/p)      %>%\nggplot( aes(x=length,y=p),col=as.factor(Sim)) +  geom_line() + mytheme\n\n# Effective sample size from Francis\nt2$var/tt$varA\ncbind(tt,t2)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  summarise(mobs=sum(p*age),var=sum(age*age*p)-mobs*mobs,sd=sqrt(var))\ntt\n\ntt <- filter(tbs) %>% mutate(age=as.numeric(age)) %>% group_by(yr,sim) %>% \n        mutate(ff=sum(catch),proportion=catch/ff)%>% summarise(ma=sum(age*proportion)) %>% \n        group_by(yr) %>% summarise(varA=var(ma))\n\ngroup_by(tt,yr) %>% mutate(mean_age=sum(age*p)) %>% ggplot(aes(x=yr,y=mean_age)) + geom_line() + mytheme\n\n\n  variance of proportion at age (sd_age) / var(average_age)\n\n  av   <- 1:15\n  av*av\nggplot(tt, aes(x=log(p),y=log(cv))) +  geom_smooth(aes(x=log(p),y=log(cv1))) + geom_point() + facet_wrap( ~ yr) +\n  mytheme + ggtitle(paste(\"Sample size =\",neff))\n\ntbl_df(tt)\nglimpse(tt)\n\n  summarise(freq=sum(freq),proportion=sum(prop))\naglf <- glf %>% select(adfg,len,freq,nobs) %>% group_by(adfg) %>% mutate(ff=sum(freq), cs = cumsum(freq)/ff ) %>% arrange(adfg,len)\n  group_by(adfg,len) %>% mutate(proportion = sum(freq)/ff) %>% arrange(adfg,len) %>% mutate(cp = cumsum(proportion)) ",
    "created" : 1502431137823.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4206518792",
    "id" : "9AC4EC4F",
    "lastKnownWriteTime" : 1463670130,
    "last_content_update" : 1463670130,
    "path" : "~/OneDrive/sampler/cases/ebswp/alk.R",
    "project_path" : "alk.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}